# ğŸš€ Load Test Toy

Spring Boot ê¸°ë°˜ ë¶€í•˜ í…ŒìŠ¤íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ - K6, Oracle DB, OpenTelemetry í†µí•©

## ğŸ“Œ í•„ìˆ˜ ìš”êµ¬ì‚¬í•­

- âœ… Docker Desktop (Mac, Windows) ë˜ëŠ” Docker Engine (Linux)
- âœ… Make (ëŒ€ë¶€ë¶„ì˜ ì‹œìŠ¤í…œì— ê¸°ë³¸ ì„¤ì¹˜)
- âœ… `aws-opentelemetry-agent.jar` íŒŒì¼ (í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— ìœ„ì¹˜)
- âœ… ìµœì†Œ 8GB RAM (ê¶Œì¥: 16GB)

## âš¡ ë¹ ë¥¸ ì‹œì‘ (3ë‹¨ê³„)

### 1ï¸âƒ£ ì²˜ìŒ ì‹¤í–‰í•˜ëŠ” ê²½ìš°

```bash
# ì´ˆê¸° ì„¤ì • + ì „ì²´ ì‹œì‘ (ìë™ DOCKER_GID ê°ì§€)
make init
```

### 2ï¸âƒ£ ëŒ€ì‹œë³´ë“œ ì ‘ì†

```
http://localhost:28080/dashboard
```

### 3ï¸âƒ£ ì¢…ë£Œ

```bash
make down
```

## ğŸ¯ ì£¼ìš” ê¸°ëŠ¥

- **K6 ë¶€í•˜ í…ŒìŠ¤íŠ¸**: ì›¹ ëŒ€ì‹œë³´ë“œì—ì„œ ì›í´ë¦­ ì‹¤í–‰
- **Oracle DB í†µí•©**: ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ ë¶€í•˜ ìƒì„±
- **ë‹¤ì–‘í•œ ì‹œë‚˜ë¦¬ì˜¤**: ë‹¨ì‹œê°„(2-5ë¶„) ë° ì¥ì‹œê°„(2-8ì‹œê°„) í…ŒìŠ¤íŠ¸
- **OpenTelemetry**: AWS ADOT ê¸°ë°˜ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ì§€ì›

---

## ğŸ“š ìƒì„¸ ê°€ì´ë“œ

### ìë™í™”ëœ ì‹œì‘ í”„ë¡œì„¸ìŠ¤

`make up` ë˜ëŠ” `make init` ì‹¤í–‰ ì‹œ ë‹¤ìŒì´ ìë™ìœ¼ë¡œ ìˆ˜í–‰ë©ë‹ˆë‹¤:

1. **Docker GID ìë™ ê°ì§€** - ì‹œìŠ¤í…œì— ë§ëŠ” Docker ì†Œì¼“ ê¶Œí•œ ì„¤ì •
2. **Oracle DB ì‹œì‘** - Health Check í†µê³¼ ëŒ€ê¸° (ì•½ 2-3ë¶„)
3. **DB ì‚¬ìš©ì ìƒì„±** - `testuser`/`testpass` ìë™ ìƒì„±
4. **Spring Boot ì•± ì‹œì‘** - OpenTelemetry ì—ì´ì „íŠ¸ì™€ í•¨ê»˜ ì‹¤í–‰
5. **ë”ë¯¸ ë°ì´í„° ìƒì„±** - 1000ê°œì˜ ì£¼ë¬¸ ë°ì´í„° ìë™ ìƒì„±

### ëŒ€ì‹œë³´ë“œ ê¸°ëŠ¥

**URL**: http://localhost:28080/dashboard

#### 1. K6 Load Test ì œì–´
- ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒ: realistic, cpu, db, mixed, high_burst
- RPS, Duration, VUs ì»¤ìŠ¤í„°ë§ˆì´ì§•
- ì‹¤ì‹œê°„ í…ŒìŠ¤íŠ¸ ì‹œì‘/ì¤‘ì§€

#### 2. Quick Tests (ë‹¨ì‹œê°„ 2-5ë¶„)
- ğŸ”¥ **Quick CPU Test**: CPU 70%, 2ë¶„
- ğŸ’¾ **Quick DB Test**: DB ì¡°íšŒ, 3ë¶„
- âš™ï¸ **Realistic Load**: í˜¼í•© ë¶€í•˜, 5ë¶„
- âš¡ **High Burst**: ê³ ë¶€í•˜, 3ë¶„

#### 3. Long Running Scenarios (ì¥ì‹œê°„ 2-8ì‹œê°„)
- ğŸ“… **Daily Pattern**: 8ì‹œê°„ - ì¼ë°˜ í•˜ë£¨ íŒ¨í„´
- ğŸ“ˆ **Gradual Increase**: 4ì‹œê°„ - ì ì§„ì  ì¦ê°€
- âš¡ **Spike Pattern**: 3ì‹œê°„ - íŠ¸ë˜í”½ ìŠ¤íŒŒì´í¬
- ğŸ›’ **Black Friday**: 6ì‹œê°„ - ëŒ€ê·œëª¨ ì´ë²¤íŠ¸
- ğŸŒ™ **Night Batch**: 2ì‹œê°„ - ì•¼ê°„ ë°°ì¹˜
- ğŸ’ª **Stress Test**: 2ì‹œê°„ - ìµœëŒ€ ë¶€í•˜

#### 4. ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§
- K6 ì‹¤í–‰ ìƒíƒœ
- DB ì—°ê²° ìƒíƒœ ë° ì£¼ë¬¸ ê±´ìˆ˜
- ì›Œí¬ë¡œë“œ ì‹¤í–‰ í˜„í™©

### ìˆ˜ë™ API í…ŒìŠ¤íŠ¸ (ì„ íƒ)

```bash
# CPU ë¶€í•˜ ìƒì„±
curl -X POST http://localhost:28080/api/workload/cpu \
  -H "Content-Type: application/json" \
  -d '{"durationMs": 2000, "cpuPercent": 70}'

# DB ì¡°íšŒ ë¶€í•˜
curl http://localhost:28080/api/workload/db/query?limit=10

# í˜„ì‹¤ì ì¸ í˜¼í•© ë¶€í•˜ (DB + CPU)
curl -X POST http://localhost:28080/api/workload/realistic \
  -H "Content-Type: application/json" \
  -d '{"durationMs": 1000, "cpuPercent": 50}'

# DB ìƒíƒœ í™•ì¸
curl http://localhost:28080/api/workload/db/status
```

---

## ğŸ”§ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### âš ï¸ ì„œë¹„ìŠ¤ ì‹œì‘ ì‹¤íŒ¨

**ì¦ìƒ**: `make up` ì‹¤í–‰ ì‹œ ì˜¤ë¥˜ ë°œìƒ

**í•´ê²°**:
```bash
# 1. ì „ì²´ ì •ë¦¬
make clean

# 2. ì¬ì‹œì‘
make init
```

### âš ï¸ Permission denied (Docker socket)

**ì¦ìƒ**: `permission denied while trying to connect to the Docker daemon socket`

**ì›ì¸**: Docker GIDê°€ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì§€ ì•ŠìŒ

**í•´ê²°**:
```bash
# Makefileì´ ìë™ìœ¼ë¡œ ê°ì§€í•˜ë¯€ë¡œ ì¬ì‹¤í–‰
make down
make up

# ë˜ëŠ” .env íŒŒì¼ ì¬ìƒì„±
make init
```

### âš ï¸ í¬íŠ¸ ì¶©ëŒ (28080)

**ì¦ìƒ**: `port is already allocated`

**í•´ê²°**:
```bash
# 28080 í¬íŠ¸ ì‚¬ìš© ì¤‘ì¸ í”„ë¡œì„¸ìŠ¤ í™•ì¸
lsof -i :28080

# í•´ë‹¹ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ ë˜ëŠ” í¬íŠ¸ ë³€ê²½
```

### âš ï¸ Oracle DB ì—°ê²° ì‹¤íŒ¨

**ì¦ìƒ**: `ORA-01017: invalid username/password`

**í•´ê²°**:
```bash
# 1. Oracle setup ë¡œê·¸ í™•ì¸
make logs oracle-setup

# 2. ì™„ì „ ì´ˆê¸°í™” ë° ì¬ì‹œì‘
make down-v
make up

# 3. ìˆ˜ë™ ì‚¬ìš©ì ìƒì„±
make shell-oracle
# SQL> CREATE USER testuser IDENTIFIED BY testpass;
# SQL> GRANT CONNECT, RESOURCE, DBA TO testuser;
```

### âš ï¸ K6 ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ

**ì¦ìƒ**: `open /scripts/dynamic.js: no such file or directory`

**ì›ì¸**: k6 ë””ë ‰í† ë¦¬ ë³¼ë¥¨ ë§ˆìš´íŠ¸ ì‹¤íŒ¨

**í•´ê²°**:
```bash
# k6 ë””ë ‰í† ë¦¬ í™•ì¸
ls -la k6/

# App ì¬ì‹œì‘
make restart-app
```

### âš ï¸ aws-opentelemetry-agent.jar ëˆ„ë½

**ì¦ìƒ**: Dockerfile ë¹Œë“œ ì‹¤íŒ¨

**í•´ê²°**:
```bash
# íŒŒì¼ ë‹¤ìš´ë¡œë“œ (ì˜ˆì‹œ)
# wget https://github.com/aws-observability/aws-otel-java-instrumentation/releases/download/v1.x.x/aws-opentelemetry-agent.jar

# ë˜ëŠ” ë¹ˆ íŒŒì¼ ìƒì„± (í…ŒìŠ¤íŠ¸ìš©)
touch aws-opentelemetry-agent.jar
```

### ğŸ’¡ ì™„ì „ ì´ˆê¸°í™”

ëª¨ë“  ê²ƒì„ ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œì‘:
```bash
# 1. ì „ì²´ ì •ë¦¬
make clean

# 2. Docker ì‹œìŠ¤í…œ ì •ë¦¬ (ì„ íƒ)
docker system prune -a

# 3. ì¬ì‹œì‘
make init

# 4. ìƒíƒœ í™•ì¸
make status
```

---

## ğŸ› ï¸ Make ëª…ë ¹ì–´

### ê¸°ë³¸ ëª…ë ¹ì–´

| ëª…ë ¹ì–´ | ì„¤ëª… |
|--------|------|
| `make help` | ì‚¬ìš© ê°€ëŠ¥í•œ ëª…ë ¹ì–´ ëª©ë¡ ë° ë„ì›€ë§ |
| `make init` | ì´ˆê¸° ì„¤ì • + ì„œë¹„ìŠ¤ ì‹œì‘ (ì²˜ìŒ ì‹¤í–‰ ì‹œ) |
| `make up` | ì„œë¹„ìŠ¤ ì‹œì‘ (ìë™ ë¹Œë“œ í¬í•¨) |
| `make down` | ì„œë¹„ìŠ¤ ì¤‘ì§€ |
| `make down-v` | ì„œë¹„ìŠ¤ ì¤‘ì§€ + ë³¼ë¥¨ ì‚­ì œ |
| `make clean` | ì „ì²´ ì •ë¦¬ (ì»¨í…Œì´ë„ˆ + ë³¼ë¥¨ + ì´ë¯¸ì§€) |

### ëª¨ë‹ˆí„°ë§ ëª…ë ¹ì–´

| ëª…ë ¹ì–´ | ì„¤ëª… |
|--------|------|
| `make logs` | ì „ì²´ ë¡œê·¸ (ì‹¤ì‹œê°„) |
| `make logs-app` | App ë¡œê·¸ë§Œ ë³´ê¸° |
| `make ps` | ì‹¤í–‰ ì¤‘ì¸ ì»¨í…Œì´ë„ˆ ëª©ë¡ |
| `make status` | ìƒíƒœ + í—¬ìŠ¤ì²´í¬ |

### ê´€ë¦¬ ëª…ë ¹ì–´

| ëª…ë ¹ì–´ | ì„¤ëª… |
|--------|------|
| `make restart` | ì „ì²´ ì¬ì‹œì‘ |
| `make restart-app` | Appë§Œ ì¬ì‹œì‘ |
| `make build` | ì´ë¯¸ì§€ ë¹Œë“œë§Œ |
| `make rebuild` | ì „ì²´ ì¬ë¹Œë“œ + ì¬ì‹œì‘ |

### ë””ë²„ê¹… ëª…ë ¹ì–´

| ëª…ë ¹ì–´ | ì„¤ëª… |
|--------|------|
| `make shell-app` | App ì»¨í…Œì´ë„ˆ Bash ì‰˜ |
| `make shell-oracle` | Oracle SQL*Plus ì ‘ì† |

---

## ğŸ—ï¸ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Docker Compose í™˜ê²½                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Oracle DB   â”‚  â”‚  Spring Boot â”‚  â”‚    K6     â”‚ â”‚
â”‚  â”‚  (XE 21.3)   â”‚  â”‚  App (Root)  â”‚  â”‚  (ë™ì )   â”‚ â”‚
â”‚  â”‚  :1521       â”‚  â”‚  :28080      â”‚  â”‚  ì‹¤í–‰     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”˜ â”‚
â”‚         â”‚                 â”‚                 â”‚        â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚              load-test-net (bridge)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì»´í¬ë„ŒíŠ¸

- **Oracle DB**: ì‹¤ì œ ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ ë¶€í•˜ ìƒì„±ìš©
- **Spring Boot App**: ë¶€í•˜ ì œì–´ + K6 ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜
- **K6**: Grafana K6 - ë™ì ìœ¼ë¡œ ìƒì„±/ì‹¤í–‰ë˜ëŠ” ë¶€í•˜ ìƒì„±ê¸°
- **OpenTelemetry**: AWS ADOT ê¸°ë°˜ ë©”íŠ¸ë¦­ ìˆ˜ì§‘ (ì˜µì…˜)

---

## ğŸ” ë³´ì•ˆ ê°œì„ ì‚¬í•­

- âœ… **Non-root ì‹¤í–‰**: Appì´ appuser(UID:1000)ë¡œ ì‹¤í–‰
- âœ… **ìµœì†Œ ê¶Œí•œ**: Docker ê·¸ë£¹ë§Œ ì¶”ê°€ (group_add)
- âœ… **Read-only ë³¼ë¥¨**: K6 ìŠ¤í¬ë¦½íŠ¸ëŠ” ì½ê¸° ì „ìš©
- âœ… **ê²©ë¦¬ëœ ë„¤íŠ¸ì›Œí¬**: load-test-net ì „ìš© ë¸Œë¦¬ì§€ ë„¤íŠ¸ì›Œí¬
- âœ… **ìë™ GID ê°ì§€**: ì‹œìŠ¤í…œë³„ Docker socket ê¶Œí•œ ìë™ ì„¤ì •

---

## ğŸ“ ê¸°ìˆ  ìŠ¤íƒ

| ì¹´í…Œê³ ë¦¬ | ê¸°ìˆ  |
|---------|------|
| **Backend** | Spring Boot 3.5.7, Java 21 |
| **Database** | Oracle XE 21.3.0 |
| **Load Testing** | Grafana K6 (latest) |
| **Observability** | AWS ADOT, OpenTelemetry Java Agent |
| **Container** | Docker, Docker Compose V2 |
| **Orchestration** | Makefile |

---

## ğŸ“ ì£¼ìš” íŒŒì¼

- **`Makefile`**: ìë™í™”ëœ ëª…ë ¹ì–´ ì •ì˜
- **`docker-compose.yml`**: ì „ì²´ ì„œë¹„ìŠ¤ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜
- **`Dockerfile`**: Spring Boot App ì´ë¯¸ì§€ ë¹Œë“œ
- **`setup-oracle.sh`**: Oracle DB ì‚¬ìš©ì ìë™ ìƒì„±
- **`K6ControlServiceImpl.java`**: K6 ì»¨í…Œì´ë„ˆ ë™ì  ì‹¤í–‰ ë¡œì§
- **`k6/dynamic.js`**: ë‹¨ì‹œê°„ ì‹œë‚˜ë¦¬ì˜¤ (2-5ë¶„)
- **`k6/long-scenarios.js`**: ì¥ì‹œê°„ ì‹œë‚˜ë¦¬ì˜¤ (2-8ì‹œê°„)

**Happy Load Testing! ğŸš€**